/*! url-router 2013-06-08 */
define("NamedGroupRegex",[],function(){function a(a){var b=this._groups=[];this._regex=new RegExp(a.replace(/:([a-zA-Z0-9]+)/g,function(a,c){return b.push(c),"([^/]+)"}))}return a.prototype.test=function(a){return this._regex.test(a.replace(/\/$/,""))},a.prototype.exec=function(a){var b=this._regex.exec(a);if(b){b=b.slice(0);for(var c=0,d=this._groups.length;d>c;c++)b[this._groups[c]]=b[c+1]}return b},a}),define("Route",[],function(){function a(a,b){this._regex=a,"function"==typeof b?this._handler=b:this._configuration=b}return a.prototype._handler=null,a.prototype._configuration=null,a.prototype._handler=function(){throw new Error("Route._handler: Unable to handle route without being supplied a function.")},a.prototype.handleUrl=function(a,b){var c,d=new Promise;try{c=this._handler.length<3?this._handler(b,a):this._handler(b,a,function(a,b){a?d.reject(a):d.resolve(b)})}catch(e){return d.reject(e)}return c&&"function"==typeof c.then?c:d.resolve(c)},a.prototype.test=function(a){return this._regex.test(a)},a.prototype.getRouteParameters=function(a){return this._regex.exec(a)},a}),define("Router",["./NamedGroupRegex","./Route"],function(a,b){function c(){Subscribable.prepareInstance(this),this._routes=[],this._initialiseEvents()}return c.prototype["config.strip.trailing.slash"]=!1,c.prototype.config=function(a,b){return void 0===b?this["config."+a]:(this["config."+a]=b,this)},c.prototype._initialiseEvents=function(){},c.prototype._handleNavigation=function(a){var b=this._getRoutesForUrl(a);b.length?this._processRoutes(b,a):this.fire("router.bad.path",a)},c.prototype._processRoutes=function(a,b){var c=[].slice.call(arguments,2),d=this.fire.bind(this),e=function(f){if(f)d("route.error",f);else if(a.length){var g=a.unshift(),h=g.getRouteParameters(b);d("route.before",g,h),g.handleUrl.apply(g,[b,h].concat(c)).then(function(a){e(null,d("route.passed",g,a))},e)}else d("router.path.finished",b)};d("router.path.starting",b),e()},c.prototype._getRoutesForUrl=function(a){return this.config("strip.trailing.slash")&&(a=a.replace(/\/$/,"")),this._routes.filter(function(b){return b.test(a)})},c.prototype.route=function(c,d){if("string"==typeof c)this.config("strip.trailing.slash")&&(c=c.replace(/\/$/,"")),c=this._buildRoute(new a(c),d);else if(c instanceof RegExp)c=this._buildRoute(c,d);else if(!(c instanceof b))throw new TypeError("Must create a route with a string, regular expression or a Route instance");return this._routes.push(c),this},c.prototype._buildRoute=function(a,c){return new b(a,c)},c}),define("BrowserRoute",["./Route"],function(a){function b(){a.apply(this,arguments)}return b.prototype=Object.create(b.superclass=a.prototype),b.prototype._handler=function(a,b){var c=new Promise,d=this._configuration,e=this,f=function(a,b){d.template=a,"function"==typeof d.model?(b=new d.model(b),b.setData&&(d.model=b)):d.model&&"function"==typeof d.model.setData&&d.model.setData(b),"function"==typeof d.controller&&(d.controller=new d.controller(d.model)),d.controller&&"function"==typeof d.controller.setModel&&d.controller.setModel(b);var c=d.model||b,f=jQuery(a.trim()),g=d.controller;e.mvc(c,f,g),f.appendTo(d.container||document.body)};return d.templateUrl?require(["text!"+d.templateUrl,"text!"+b],f):require(["text!"+b],function(a){f(d.template||"<div />",a)}),c},b}),define("BrowserRouter",["./Router","./BrowserRoute"],function(a,b){function c(){a.call(this)}return c.prototype=Object.create(c.superclass=a.prototype),c.prototype._initialiseEvents=function(){jQuery(window).on("popState",this._handleHistoryNavigation.bind(this)),jQuery(document).on("click","a[href]",this._handleClickNavigation.bind(this))},c.prototype._handleHistoryNavigation=function(){this._handleHistoryNavigation(location.pathname)},c.prototype._handleClickNavigation=function(a){a.preventDefault(),history.pushState({},"",a.currentTarget.getAttribute("href")),this._handleHistoryNavigation(location.pathname)},c.prototype._buildRoute=function(a,c){return new b(a,c)},c});