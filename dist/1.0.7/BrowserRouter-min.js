/*! url-router 2013-06-23 */
define("NamedGroupRegex",[],function(){function a(a){var b=this._groups=[];this._regex=new RegExp(a.replace(/:([a-zA-Z0-9]+)/g,function(a,c){return b.push(c),"([^/]+)"}))}return a.prototype.test=function(a){return this._regex.test(a)},a.prototype.exec=function(a){var b=this._regex.exec(a);if(b){b=b.slice(0);for(var c=0,d=this._groups.length;d>c;c++)b[this._groups[c]]=b[c+1]}return b},a}),define("Route",["promise"],function(a){function b(a,b){this._regex=a,"function"==typeof b?this._handler=b:this._configuration=b}return b.prototype._handler=null,b.prototype._configuration=null,b.prototype._handler=function(){throw new Error("Route._handler: Unable to handle route without being supplied a function.")},b.prototype.handleUrl=function(b){var c,d=new a;try{this._handler.length<2?c=this._handler(b):this._handler(b,function(a,b){a?d.reject(a):d.resolve(b)})}catch(e){return d.reject(e)}return c&&"function"==typeof c.then?c:this._handler.length<2?d.resolve(c):d},b.prototype.test=function(a){return this._regex.test(a)},b.prototype.getRouteParameters=function(a){return this._regex.exec(a)},b}),define("Router",["./NamedGroupRegex","./Route","subscribable"],function(a,b,c){function d(){this._routes=[],this._initialiseEvents()}return d.prototype=Object.create(c.prototype),d.prototype["config.strip.trailing.slash"]=!1,d.prototype["config.model.getter"]="getModel",d.prototype["config.model.setter"]="setModel",d.prototype["config.view.setter"]="setView",d.prototype.config=function(a,b){return void 0===b?this["config."+a]:(this["config."+a]=b,this)},d.prototype._initialiseEvents=function(){},d.prototype._handleNavigation=function(a){var b=this._cleanUrl(a),c=this._getRoutesForUrl(b);c.length||this.fire("router.bad.path",b),this._processRoutes(c,a)},d.prototype._cleanUrl=function(a){return this.config("strip.trailing.slash")&&(a=a.replace(/\/$/,"")),a},d.prototype._processRoutes=function(a,b){var c={url:b},d=[].slice.call(arguments,2),e=this.fire.bind(this),f=function(g){if(g)e("route.error",g);else if(a.length){var h=a.shift();c.param=h.getRouteParameters(b)||{},e("route.before",h,c),h.handleUrl.apply(h,[c].concat(d)).then(function(a){e("route.passed",h,a),f(null,a)},f)}else e("router.path.finished",b)};e("router.path.starting",b),f()},d.prototype._getRoutesForUrl=function(a){return this._routes.filter(function(b){return b.test(a)})},d.prototype.route=function(c,d){if("string"==typeof c)this.config("strip.trailing.slash")&&(c=c.replace(/\/$/,"")),c=this._buildRoute(new a(c),d);else if(c instanceof RegExp)c=this._buildRoute(c,d);else if(!(c instanceof b))throw new TypeError("Must create a route with a string, regular expression or a Route instance");return this._routes.push(c),this},d.prototype._buildRoute=function(a,c){return new b(a,c)},d}),define("BrowserRoute",["./Route","promise"],function(a,b){function c(){a.apply(this,arguments)}var d=function(a,b){return String(a).replace(/\{([^\}]+)\}/g,function(a,c){return b&&b[c]})};return c.prototype=Object.create(c.superclass=a.prototype),c.prototype._handler=function(a){var c=a.param,e=a.url,f=new b,g=this._configuration,h=function(b,d){g.template=b,d=d||a,"function"==typeof g.model?(d=new g.model(d),d.setData&&(g.model=d)):g.model&&"function"==typeof g.model.setData&&g.model.setData(d),"function"==typeof g.controller&&(g.controller=new g.controller(g.model)),g.controller&&"function"==typeof g.controller.setRoute&&g.controller.setRoute(c,g.model||d);var e=g.model||d,f=jQuery(b.trim()),h="function"==typeof g.view?new g.view(f):f,i=g.controller;g.getModel(i)!==e&&g.setModel(i,e),g.setView(i,h),g.setModel(h,e),g.replace?jQuery(g.replace).replaceWith(f):f.appendTo(g.container||document.body)},i={done:function(a){this._data=this._data||a,--this._pending<=0&&h(this.template||"<div />",this._data)},start:function(){this._pending||this.done(null)},add:function(){this._pending++},template:g.template,_data:null,_pending:0};return g.templateUrl&&i.add(require(["text!"+d(g.templateUrl,c)],function(a){i.template=a,i.done(null)})),(!g.noData||g.dataUrl)&&i.add(require(["text!"+d(g.dataUrl||e,c)],function(a){if("{[".indexOf(String(a).trim().charAt(0))>=0)try{a=JSON.parse(a)}catch(b){}i.done(a)})),"model view controller".split(" ").forEach(function(a){"string"==typeof g[a]&&i.add(require([g[a]],function(b){g[a]=b,i.done(null)}))}),i.start(),f},c}),define("BrowserRouter",["./Router","./BrowserRoute","subscribable"],function(a,b,c){function d(){a.call(this)}return d.prototype=Object.create(d.superclass=a.prototype),c.prepareInstance(d),d.prototype["config.model.getter"]="getModel",d.prototype["config.model.setter"]="setModel",d.prototype["config.view.setter"]="setView",d.prototype._initialiseEvents=function(){jQuery(window).on("popstate",this._handleHistoryNavigation.bind(this)),jQuery(document).on("click","a[href]",this._handleClickNavigation.bind(this)),this.on("route.before",d._cacheCurrentRoute,d),this.on("route.before",d.fire,d)},d._cacheCurrentRoute=function(a,b){d.currentRoute=a,d.currentRouteParameters=b},d.prototype._handleHistoryNavigation=function(){this._handleNavigation(location.pathname)},d.prototype._handleClickNavigation=function(a){a.preventDefault(),history.pushState({},"",a.currentTarget.getAttribute("href")),this._handleNavigation(location.pathname)},d.prototype._buildRoute=function(a,c){if("function"!=typeof c){var d=this;c.getModel=function(a){return a&&a[d.config("model.getter")]&&a[d.config("model.getter")]()},c.setModel=function(a,b){return a&&a[d.config("model.setter")]&&a[d.config("model.setter")](b)},c.setView=function(a,b){return a&&a[d.config("view.setter")]&&a[d.config("view.setter")](b)}}return new b(a,c)},d});